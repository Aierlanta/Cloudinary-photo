# 实施计划

- [x] 1. 项目初始化和基础配置

  - 创建 Next.js 项目结构，配置 TypeScript 和必要的依赖包
  - 设置 Tailwind CSS 和基础样式配置
  - 配置环境变量验证和 Replit 部署文件
  - _需求: 5.1, 5.4_

- [x] 2. 核心数据模型和类型定义

  - 定义 Image、Group、APIConfig 等 TypeScript 接口
  - 创建错误类型和 API 响应类型定义
  - 实现数据验证 schema（使用 Zod）
  - _需求: 1.3, 2.1, 4.4, 6.4_

- [x] 3. 数据库服务层实现

  - 实现 DatabaseService 类，包含所有数据库操作方法
  - 创建 Replit Database 连接和初始化逻辑
  - 实现图片索引管理和随机选择算法
  - 编写数据库服务的单元测试
  - _需求: 1.3, 2.2, 3.1, 7.2_

- [x] 4. Cloudinary 集成服务

  - 实现 CloudinaryService 类，包含上传、删除、获取 URL 等方法
  - 配置 Cloudinary SDK 和环境变量读取
  - 实现图片下载和转换功能
  - 添加错误处理和重试机制
  - 编写 Cloudinary 服务的单元测试
  - _需求: 1.2, 1.6, 5.1, 6.3_

- [x] 5. 公开随机图片 API 端点实现

  - 创建/api/random 路由处理器（唯一的公开 API 端点）
  - 实现参数解析和验证逻辑（根据管理员配置的允许参数）
  - 实现根据参数和配置筛选随机图片的逻辑
  - 直接返回图片文件，不返回 JSON 格式数据
  - 添加参数验证错误处理和 HTTP 状态码响应
  - 编写 API 端点的集成测试，包括各种参数组合
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 6. 内部管理 API 端点实现（仅供管理面板使用）

- [x] 6.1 图片管理 API

  - 实现 GET /api/admin/images（支持分页和日期筛选）
  - 实现 POST /api/admin/images（图片上传）
  - 实现 DELETE /api/admin/images/[id]（图片删除）
  - 添加文件类型和大小验证
  - 添加管理员认证验证
  - _需求: 1.5, 1.6, 1.7, 1.8, 1.9_

- [x] 6.2 分组管理 API

  - 实现 GET /api/admin/groups（获取分组列表）
  - 实现 POST /api/admin/groups（创建分组）
  - 实现 PUT /api/admin/groups/[id]（更新分组）
  - 实现 DELETE /api/admin/groups/[id]（删除分组）
  - 添加管理员认证验证
  - _需求: 2.1, 2.2, 2.4, 2.5_

- [x] 6.3 API 配置管理

  - 实现 GET /api/admin/config（获取 API 参数配置）
  - 实现 PUT /api/admin/config（更新 API 参数配置）
  - 实现 API 参数的增删改查功能
  - 添加参数值与分组映射的配置逻辑
  - 添加配置验证和持久化逻辑
  - 显示公开 API 的访问链接和参数使用说明
  - _需求: 4.1, 4.2, 4.3, 4.5, 4.8_

- [x] 7. 认证中间件和安全措施

  - 实现简单的管理员密码认证中间件
  - 添加 API 限流保护
  - 实现请求验证和安全头设置
  - _需求: 5.3, 6.2_

- [-] 8. 管理面板 UI 组件开发

- [x] 8.1 基础布局和导航

  - 创建管理面板的主布局组件
  - 实现导航菜单和路由结构
  - 添加认证状态管理和登录表单
  - 实现完全可控的透明度面板界面（支持透明度滑块控制）
  - 使用纯透明背景设计，不使用毛玻璃或模糊效果
  - _需求: 1.1_

- [x] 8.2 图片管理界面

  - 实现图片列表展示组件（支持分页）
  - 创建图片上传组件和进度显示
  - 实现日期筛选和搜索功能
  - 添加图片预览和操作按钮
  - 确保透明面板下的文字和按钮保持良好的可读性和可操作性

  - _需求: 1.1, 1.4, 1.5, 1.6_

- [x] 8.3 分组管理界面

  - 创建分组列表和创建表单组件
  - 实现分组编辑和删除功能
  - 添加图片分组分配界面
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 8.4 API 配置界面

  - 创建 API 参数配置管理页面
  - 实现 API 参数的添加、编辑、删除界面
  - 实现参数值与分组映射的配置界面
  - 添加默认访问范围设置
  - 显示公开 API 的访问链接和参数使用示例
  - 添加参数配置的预览和测试功能
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.8_

- [x] 9. 错误处理和日志系统

  - 实现统一的错误处理中间件
  - 创建日志记录工具和格式化函数
  - 添加错误边界组件和用户友好的错误页面
  - 实现 API 错误响应标准化
  - _需求: 6.1, 6.2, 6.4, 5.3_

- [ ] 10. 性能优化实现

  - 实现图片懒加载和虚拟滚动
  - 添加 SWR 数据缓存和重新验证
  - 优化数据库查询和索引结构
  - 实现 Cloudinary 图片转换和 CDN 优化
  - _需求: 7.1, 7.2, 7.3, 7.4_

- [ ] 11. 测试套件完善

  - 编写所有 API 端点的集成测试
  - 创建 React 组件的单元测试
  - 实现端到端测试覆盖主要用户流程
  - 添加测试数据生成和清理工具
  - _需求: 7.5_

- [ ] 12. Replit 部署配置和优化

  - 配置 replit.nix 和.replit 文件
  - 设置生产环境构建脚本
  - 优化 Next.js 配置用于 Replit 部署
  - 创建环境变量配置文档
  - _需求: 5.2, 5.4_

- [ ] 13. API 文档和使用说明

  - 创建公开 API 端点的使用文档
  - 编写部署和配置说明文档
  - 添加故障排除和常见问题解答
  - 创建外部用户使用公开 API 的示例代码
  - _需求: 3.4_

- [ ] 14. 最终集成和测试
  - 进行完整的系统集成测试
  - 验证所有功能在 Replit 环境中的正常运行
  - 性能测试和负载测试
  - 修复发现的问题和优化性能瓶颈
  - _需求: 7.1, 7.4, 7.5_
